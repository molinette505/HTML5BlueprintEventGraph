#graph-container {
    width: 100%; height: 100%;
    background-color: #1a1a1a;
    background-image: 
        linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
        linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
    background-position: -1px -1px;
    cursor: grab; position: relative; overflow: hidden;
}
#graph-container:active { cursor: grabbing; }

#transform-layer { transform-origin: 0 0; position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; }
#connections-layer { width: 100%; height: 100%; position: absolute; top:0; left:0; overflow: visible; z-index: 1; pointer-events: none; }
#nodes-layer { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 10; pointer-events: none; }

/* NODES */
.node {
    position: absolute; min-width: 140px;
    background: var(--node-bg);
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5), 0 0 0 1px rgba(0,0,0,0.4);
    color: #eee; font-size: 12px;
    display: flex; flex-direction: column;
    pointer-events: all;
    backdrop-filter: blur(4px);
    transition: box-shadow 0.2s;
}
.node:hover { box-shadow: 0 6px 20px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.2); z-index: 100; }

.node-header {
    padding: 8px 12px; border-radius: 8px 8px 0 0; font-weight: 700;
    background: linear-gradient(180deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
    display: flex; align-items: center; gap: 8px;
    border-bottom: 1px solid rgba(0,0,0,0.3); text-shadow: 0 1px 2px rgba(0,0,0,0.8);
}

.node-body { 
    padding: 8px 0; display: grid; 
    grid-template-columns: auto 1fr auto; 
    align-items: start; width: 100%;
}

.col { display: flex; flex-direction: column; justify-content: flex-start; }
.col-left { align-items: flex-start; margin-right: 8px; padding-left: 0; min-width: 20px; }
.col-right { align-items: flex-end; margin-left: 8px; padding-right: 0; min-width: 20px; }
.col-center { align-items: center; justify-content: center; display: flex; flex-direction: column; height: 100%; min-width: 20px; }
.center-label { font-weight: bold; font-size: 18px; opacity: 0.7; align-self: center; justify-self: center; margin-top: 4px; }

/* PINS */
.pin-row { display: flex; align-items: center; height: 26px; position: relative; white-space: nowrap; }
.pin-label { margin: 0 8px; color: #ccc; font-size: 11px; font-weight: 500; pointer-events: none; }

.pin {
    width: 12px; height: 12px; box-sizing: border-box;
    border: 2px solid var(--pin-color); border-radius: 50%;
    background: transparent; cursor: crosshair;
    transition: transform 0.15s, background-color 0.15s;
    position: relative; pointer-events: all; margin-top: 1px; flex-shrink: 0;
}
.pin:hover { transform: scale(1.3); background-color: rgba(255,255,255,0.3); }
.pin.connected { background-color: var(--pin-color); } /* Filled when connected */
.pin.snapped { transform: scale(1.6); box-shadow: 0 0 10px white; background-color: var(--pin-color) !important; border-color: white !important; }

/* EXEC PINS */
.pin.exec {
    border-radius: 0; width: 14px; height: 15px; border: none; background: none;
    clip-path: polygon(0 0, 80% 0, 100% 50%, 80% 100%, 0 100%);
    background-color: white; opacity: 0.9; margin-top: 0;
}
.pin.exec:hover { opacity: 1; transform: scale(1.2); }

/* WIDGETS */
.node-widget {
    background: #111; border: 1px solid #333; color: white;
    border-radius: 3px; font-size: 11px; padding: 2px 4px;
    margin: 0 4px; height: 18px; font-family: monospace;
    pointer-events: all; display: inline-block;
}
.widget-vec3 { display: flex; gap: 2px; pointer-events: all; }
.widget-vec3 input { width: 35px; text-align: center; border: 1px solid #333; background: #111; color: #ddd; font-size: 10px; border-radius: 2px; }

/* Hide widgets when connected */
.pin-row.has-connection .node-widget, .pin-row.has-connection .widget-vec3 { display: none !important; }

/* WIRES */
path.connection {
    fill: none; stroke: var(--wire-default); stroke-width: 2px;
    stroke-linecap: round; pointer-events: stroke; cursor: pointer;
    transition: stroke-width 0.1s, stroke 0.2s;
}
path.connection:hover { stroke-width: 4px; stroke: var(--danger); }
path.connection.pulse {
    stroke: var(--wire-highlight); stroke-width: 4px;
    filter: drop-shadow(0 0 5px orange); animation: dash 0.5s linear infinite; stroke-dasharray: 10, 5;
}
@keyframes dash { to { stroke-dashoffset: -15; } }